---
title: "download_cubes"
author: "Sander Devisscher"
date: "2024-10-18"
params:
  rank: 
  - NULL
---

```{r libraries}
library(rgbif)
library(tidyverse)
```

```{r read query}
rank <- params$rank

print(rank)

query <- paste0("data/interim/cube_queries/griis_belgium_", tolower(rank), "_query.txt") %>% 
  readLines() 
```

```{r download cubes}
cube <- occ_download_sql(q = query, 
                         format = "SQL_TSV_ZIP",
                         email = Sys.getenv("email"),
                         user = Sys.getenv("gbif_user"),
                         pwd = Sys.getenv("gbif_pwd"))
```

```{r create cube_data folder}
if(!dir.exists("./cube_data")){
  dir.create("./cube_data")
}
```

```{r}
occ_download_wait(cube)

occ_download_get(cube, overwrite = TRUE) %>%
  occ_download_import() %>% 
  write_csv(file = paste0("./cube_data/be_alientaxa_cube_", rank, ".csv"))
```

