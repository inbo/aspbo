 SELECT year, GBIF_EEARGCode( 1000, decimalLatitude, decimalLongitude, COALESCE(coordinateUncertaintyInMeters, 1000) ) AS eeaCellCode, classKey, class, taxonKey, scientificName, COUNT(*) AS occurrences, MIN(COALESCE(coordinateUncertaintyInMeters, 1000)) AS minCoordinateUncertaintyInMeters, MIN(GBIF_TemporalUncertainty(eventDate)) AS minTemporalUncertainty, IF(ISNULL(classKey), NULL, SUM(COUNT(*)) OVER (PARTITION BY classKey)) AS classCount FROM occurrence WHEREoccurrenceStatus = 'PRESENT' AND taxonKey IN (6157050, 7190901, 6157035, 6157026, 7062200, 4925890, 5544928, 5545159, 5831060, 7223276, 7222196, 9448191, 7466434, 7224157, 6308164, 4271356, 4048052, 7271631, 8045533, 8358048, 7272439, 6369140, 8421432, 3663237, 3802956, 7427650, 7323906, 7224427, 5359402, 5352372, 5352425, 7068379, 7225471, 2974921, 2914404, 7225621, 3042889, 3040999, 7068732, 3047633, 7853188, 7295374, 6432925, 7331861, 9508942, 6409536, 7096205, 6411098, 7308043, 7223680, 5659657, 4090836, 7068845, 7323341, 5548011, 7267492, 7267631, 5652131, 7415922, 7901010, 4036957, 3602069, 3065244, 7293222, 5825913, 7230699, 2769073, 7421129, 7070211, 7227181, 7998563, 8257546, 8369366, 6710856, 4104890, 4131042, 7226804, 6449041, 2706403, 2717402, 6085036, 10966302, 3596131, 6076957, 4211590, 4219118, 6164210, 5224543, 5224481, 10755213, 8991514, 9462721, 9405036, 4123394, 2705287, 4132902, 4132112, 8338571, 4270548, 4115425, 4932232, 8389446, 6313049, 6313051, 12205713, 8918909, 7226794, 6084799, 8134874, 6156934, 6427623, 7225712, 11162940, 7302355, 9405645, 7277946, 5928306, 5373483, 7740944, 3047147, 8257857, 7266343, 7266329, 7427741, 8336551, 7298085, 9454901, 7323251, 5587240, 7223177, 7222255, 11136683, 4250676, 10948891, 4248063, 6076279, 6302047, 6300531, 7224069, 9771172, 7332517, 7757431, 7308335, 3898065, 8006893, 7332416, 7327959, 11844792, 7219988, 7925720, 7409013, 3023671, 7272185, 3666059, 7324507, 7066596, 8323119, 5347854, 7536406, 7455425, 7323834, 3922770, 7226776, 4270675, 5373039, 8381801, 3746867, 2653392, 7440977, 9537212, 5581279, 4194303, 7225456, 9603492, 7753114, 6420901, 4273336, 7358677, 7624620, 4036350, 3755928, 3757050, 9567226, 11794300, 8925248, 6550056, 12132283, 3890974, 8983123, 5365494) AND continent = 'EUROPE' AND year >= 1900 AND hasCoordinate = TRUE AND NOT ARRAY_CONTAINS(issue, 'ZERO_COORDINATE') AND NOT ARRAY_CONTAINS(issue, 'COORDINATE_OUT_OF_RANGE') AND NOT ARRAY_CONTAINS(issue, 'COORDINATE_INVALID') AND NOT ARRAY_CONTAINS(issue, 'COUNTRY_COORDINATE_MISMATCH') AND LOWER(identificationVerificationStatus) NOT IN ( 'unverified', 'unvalidated', 'not validated', 'under validation', 'not able to validate', 'control could not be conclusive due to insufficient knowledge', 'uncertain', 'unconfirmed', 'unconfirmed - not reviewed', 'validation requested' ) GROUP BY year, eeaCellCode, classKey, class, taxonKey, scientificName ORDER BY year DESC, eeaCellCode ASC, taxonKey ASC;
